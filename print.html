<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <style>
      * {
        box-sizing: border-box;
        font-family: Helvetica;
      }

      :root {
        --page-width: 0;
        --page-height: 0;
        --footer-font-size: 0;
        --footer-padding: 0;
      }

      h1, h2, p {
        margin: 0;
      }

      #print-wrapper {
        display: flex;
        align-items: center;
        flex-direction: column;
      }

      #cover {
        height: var(--page-height);
      }

      #cover,
      .print {
        width: var(--page-width);
        /* height: var(--page-height); */
        padding: 19mm;
      }

      .print p {
        margin-top: 10mm;
      }

      main h1 {
        color: #333;
      }

      footer {
        width: var(--page-width);
        font-size: var(--footer-font-size);
        padding: var(--footer-padding);
        background-color: #555;
        color: white;
        display: flex;
        justify-content: space-between;
      }
    </style>

    <h1>Print PDF</h1>
    <button id="print-button">Print</button>
    <hr></hr>
    <section id="print-wrapper">
      <div id="cover">
        <h1>Cover Page</h1>
      </div>
      <div id="first" class="print">
        <h2>First Page</h2>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Aspernatur aliquid, at eos pariatur laudantium nobis nostrum! Facilis, perferendis in culpa voluptate corporis accusantium fugiat facere magni dignissimos ipsa. Dolores quas, repellat impedit hic eaque, vero excepturi at ipsum sed eius eveniet laboriosam deleniti vitae ratione. A veniam ullam quaerat placeat dolorum dignissimos, totam nostrum rem necessitatibus. Voluptatibus molestias consequuntur ad quo esse vitae in! Dolores cumque dolor earum nam quos odio itaque rem! Dignissimos blanditiis illo, cum fugiat neque sit quasi facilis autem odio provident tenetur a incidunt voluptate culpa optio doloribus. Ipsa, expedita consectetur iure suscipit numquam dignissimos odit?
        </p>
      </div>
      <div id="second" class="print">
        <h2>Second Page</h2>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Rem voluptatum alias fugiat sed dignissimos quibusdam accusantium sit voluptatem illum, voluptates odio praesentium eum reprehenderit molestiae tempore. Tempore, sed! Accusamus, unde animi necessitatibus ut veniam eius quidem ipsam delectus, quas deleniti quam a. Libero pariatur quae odio dolore nobis optio non quidem impedit? Fugiat odio quae modi aliquam non explicabo quo. Aliquid porro, ab id nesciunt, harum, ullam alias eius sint expedita distinctio dolore cupiditate aperiam est dolor quo. Quam quisquam cumque nobis necessitatibus facere deleniti saepe et voluptates at, voluptate repudiandae obcaecati temporibus ipsa eveniet totam provident, neque eius natus!
        </p>
      </div>
      <div id="third" class="print">
        <h2>Third Page</h2>
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Veritatis, magni. Ipsum, sunt saepe. Atque quae quas nesciunt aliquam alias esse, reprehenderit optio id aut libero est. Molestias quae expedita debitis minus quo fuga distinctio soluta saepe asperiores. Fugit, soluta sunt odit accusantium quis, a labore hic quae illo deserunt quos. Quas delectus earum voluptates ab magni nulla saepe dolore. Repellat omnis quos nobis. Repellat voluptatibus autem magni quibusdam ex. Dignissimos, voluptatibus. Quidem esse vero dicta sed asperiores earum minima hic aut harum dolorum eveniet a quaerat beatae nemo, veritatis blanditiis cupiditate magnam. Earum cumque sint maxime modi veniam rerum laboriosam asperiores itaque repudiandae quam, atque similique quis fugiat corporis ipsam optio sunt, in illo? Alias velit natus delectus soluta atque placeat, cum laboriosam qui nam iste vero laudantium eaque animi consectetur quisquam asperiores eveniet! Nobis, eius aliquam. Enim libero quos accusantium similique voluptate fugit sint nihil illum consequatur! Hic, consequatur deserunt tenetur esse molestiae harum quis, mollitia sed dignissimos incidunt amet perferendis ea, sapiente omnis eos quod. Incidunt, deserunt cupiditate expedita reiciendis quasi, minus temporibus ea neque, blanditiis molestiae aperiam quo. Ut ratione modi consequuntur minus laborum, nisi magni aliquid soluta totam, libero, illo suscipit veritatis fugiat! Quaerat iure doloribus non rerum rem labore maxime ea mollitia velit ipsam tenetur maiores nesciunt eum, necessitatibus nobis voluptas alias amet atque eius iusto! Harum magnam, cupiditate quis provident eligendi exercitationem eum fugit praesentium repudiandae, in debitis. Quis dolores culpa labore ullam itaque voluptatibus, omnis ducimus recusandae placeat hic corrupti perferendis quidem rerum? Blanditiis ipsa dolorem praesentium, itaque non labore dolor rerum. Quas aliquid vitae laborum totam sed magnam excepturi nemo corporis, error ducimus ipsa optio, earum aspernatur explicabo debitis blanditiis animi similique, pariatur harum repudiandae nesciunt doloribus praesentium saepe voluptates! Facere cupiditate maxime accusamus deleniti beatae perferendis nihil distinctio in impedit debitis odio amet ipsam soluta, consequatur sint iste earum corrupti suscipit laboriosam provident, eligendi consequuntur atque? Ratione voluptate, dignissimos deserunt, error atque nostrum officia tenetur praesentium quae voluptatibus sit commodi? Veritatis accusamus quaerat magni eius praesentium obcaecati, neque rerum quae similique placeat quo ex soluta in, atque nesciunt, iusto ipsum dolores nobis adipisci repellat repellendus? Esse iusto numquam rerum officia natus sapiente omnis neque! Blanditiis incidunt quaerat itaque, repellendus commodi corporis nostrum doloremque eaque similique voluptas voluptatem autem nam pariatur magni assumenda perferendis iste modi sequi ad expedita enim ducimus reiciendis id. Rem iste voluptate, nam enim mollitia cumque veniam. Illum.
        </p>
      </div>
      <main id="main" class="print">
        <h2>Hello World</h2>
        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Aliquid dolore aut corporis modi, non, alias nostrum nesciunt, deserunt dolorum veritatis saepe impedit vel! Ratione tempora reprehenderit non excepturi, corrupti alias quis sint nam itaque, possimus impedit officia inventore doloribus? Reprehenderit, corporis soluta rem dolorum nisi repellendus molestias ipsam eaque dignissimos quia quod. Sunt, praesentium. Quo asperiores quod quia possimus maiores nulla. Explicabo a quia incidunt iusto ipsam qui consequuntur dolor. Neque autem omnis sequi cum est aliquid odit iusto, dicta deserunt suscipit incidunt sint. Facere enim, tempora inventore itaque harum distinctio ipsum ut at natus provident, aliquam nostrum omnis, maiores ex saepe qui dolor! Corrupti quas inventore cupiditate tempora, necessitatibus sequi recusandae ipsam est itaque distinctio voluptate maxime facere natus, impedit, eos aspernatur corporis eligendi excepturi exercitationem! Tempore omnis similique molestias. Quidem adipisci reprehenderit rem, hic ullam molestiae quasi. Veniam quidem incidunt itaque placeat tenetur rem officia blanditiis, praesentium nostrum quam enim, delectus beatae magni earum eius officiis, ipsam vel? Quae praesentium rerum harum labore neque temporibus quam. Corrupti in, distinctio voluptas inventore voluptate blanditiis neque et, officia, necessitatibus incidunt quos repellendus doloribus labore fugit! Quasi eaque porro harum commodi cum repellendus vitae, animi sapiente dolorem dolore molestiae cupiditate accusamus?</p>
      </main>
      <div id="last" class="print">
        <h2>Last Page</h2>
      </div>
      <footer>
        <p>Rock the World</p>
      </footer>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
    <script>
      const paginationWidthMM = 10;

      const heightRatio = 1.414;
      const widthMM = 210;
      const heightMM = widthMM * heightRatio;
      document.documentElement.style.setProperty('--page-width', `${widthMM}mm`);
      document.documentElement.style.setProperty('--page-height', `${heightMM}mm`);
      const footerFontSize = 11;
      const footerPaddingMM = 8;
      document.documentElement.style.setProperty('--footer-font-size', `${footerFontSize}`);
      document.documentElement.style.setProperty('--footer-padding', `${footerPaddingMM}mm`);

      const printButton = document.getElementById('print-button');
      const cover = document.getElementById('cover');
      const main = document.querySelector('main');
      const footer = document.querySelector('footer');

      const printSections = Array.from(document.getElementsByClassName('print'));

      const printInWindow = (
        /** @type {{ title: string; content: Node }} */ config,
      ) => {
        const w = window.open('', 'PRINT', 'height=650,width=900,top=100,left=150');

        w.document.title = config.title;

        const root = config.content.cloneNode(true);

        w.document.body.appendChild(root);

        w.print();
      };

      const printImage = () => {
        html2canvas(content).then((/** @type {HTMLCanvasElement} */ canvas) => {
          preview.appendChild(canvas);

          const dataURL = canvas.toDataURL();

          const a = document.createElement('a');
          a.download = 'Hello.png';
          a.href = dataURL;

          a.click();
        });
      };

      const print = () => {
        const pdf = new jspdf.jsPDF('p', 'mm', 'a4');

        Promise.all(
          [cover, footer].map((element) => {
            return html2canvas(element);
          }),
        ).then(([coverCanvas, footerCanvas]) => {
          const pxToMM = (/** @type {number} */ px) => {
            return px * widthMM / coverCanvas.width;
          };

          const footerHeightMM = pxToMM(footerCanvas.height);
          const footerTopMM = heightMM - footerHeightMM;

          pdf.addImage(coverCanvas, 'PNG', 0, 0, widthMM, heightMM);

          Promise.all(
            printSections.map((element) => {
              return html2canvas(element);
            }),
            ).then((/** @type {HTMLCanvasElement} */ canvases) => {
              pdf.addPage();
              let pageCount = 1;
              let remaningHeight = heightMM;

              canvases.forEach((canvas) => {
              const canvasHeightMM = pxToMM(canvas.height);

              let canvasTopMM = heightMM - remaningHeight;
              remaningHeight -= canvasHeightMM;

              if (remaningHeight < 0) {
                pdf.addPage();
                pageCount += 1;
                remaningHeight = heightMM - canvasHeightMM;
                canvasTopMM = 0;
              }

              pdf.addImage(canvas, 'PNG', 0, canvasTopMM, widthMM, canvasHeightMM);
              pdf.addImage(footerCanvas, 'PNG', 0, footerTopMM, widthMM, footerHeightMM);
              pdf.setFontSize(footerFontSize);
              pdf.setTextColor(255, 255, 255);
              pdf.text(`${pageCount}`, widthMM - footerPaddingMM - paginationWidthMM, footerTopMM + footerPaddingMM + 4);
            });

            pdf.save('Hello.pdf');
          });
        });
      };

      printButton.addEventListener('click', () => {
        print();
      });
    </script>
  </body>
</html>
