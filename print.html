<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <style>
      * {
        box-sizing: border-box;
        font-family: Helvetica;
      }

      :root {
        --page-width: 0;
        --page-height: 0;
      }

      h1 {
        margin: 0;
      }

      #print-wrapper {
        display: flex;
        align-items: center;
        flex-direction: column;
      }

      #cover,
      .print{
        width: var(--page-width);
        height: var(--page-height);
        padding: 19mm;
      }

      main h1 {
        color: #333;
      }

      footer {
        width: var(--page-width);
        font-size: 11;
        padding: 8mm;
        background-color: #555;
        color: white;
      }
    </style>

    <h1>Print PDF</h1>
    <button id="print-button">Print</button>
    <hr></hr>
    <section id="print-wrapper">
      <div id="cover">
        <h1>Cover Page</h1>
      </div>
      <main class="print">
        <h1>Hello World</h1>
      </main>
      <footer>
        Rock the World
      </footer>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
    <script>
      const heightRatio = 1.414;
      const widthMM = 210;
      const heightMM = widthMM * heightRatio;
      document.documentElement.style.setProperty('--page-width', `${widthMM}mm`);
      document.documentElement.style.setProperty('--page-height', `${heightMM}mm`);

      const printButton = document.getElementById('print-button');
      const cover = document.getElementById('cover');
      const main = document.querySelector('main');
      const footer = document.querySelector('footer');

      const printInWindow = (
        /** @type {{ title: string; content: Node }} */ config,
      ) => {
        const w = window.open('', 'PRINT', 'height=650,width=900,top=100,left=150');

        w.document.title = config.title;

        const root = config.content.cloneNode(true);

        w.document.body.appendChild(root);

        w.print();
      };

      const printImage = () => {
        html2canvas(content).then((/** @type {HTMLCanvasElement} */ canvas) => {
          preview.appendChild(canvas);

          const dataURL = canvas.toDataURL();

          const a = document.createElement('a');
          a.download = 'Hello.png';
          a.href = dataURL;

          a.click();
        });
      };

      const print = () => {
        const pdf = new jspdf.jsPDF('p', 'mm', 'a4');

        Promise.all(
          [cover, footer].map((element) => {
            return html2canvas(element);
          }),
        ).then(([coverCanvas, footerCanvas]) => {
          const pxToMM = (/** @type {number} */ px) => {
            return px * widthMM / coverCanvas.width;
          };

          pdf.addImage(coverCanvas, 'PNG', 0, 0, widthMM, heightMM);

          const footerHeightMM = pxToMM(footerCanvas.height);
          const footerTopMM = heightMM - footerHeightMM;

          Promise.all(
            Array.from(document.getElementsByClassName('print')).map((element) => {
              return html2canvas(element);
            }),
          ).then((/** @type {HTMLCanvasElement[]} */ canvases) => {
            canvases.forEach((canvas, i) => {
              pdf.addPage();
              pdf.addImage(canvas, 'PNG', 0, 0, widthMM, heightMM);
              pdf.addImage(footerCanvas, 'PNG', 0, footerTopMM, widthMM, footerHeightMM);
            });

            pdf.save('Hello.pdf');
          });
        });
      };

      printButton.addEventListener('click', () => {
        print();
      });
    </script>
  </body>
</html>
